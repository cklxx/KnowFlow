import type {
  TodayWorkoutPlan,
  WorkoutCompletionSummary,
} from '@api';

const now = new Date('2024-10-08T09:00:00Z');

export const mockTodayWorkout: TodayWorkoutPlan = {
  workout_id: 'workout-mock-001',
  scheduled_for: new Date(now.getTime()).toISOString(),
  generated_at: new Date(now.getTime() - 5 * 60 * 1000).toISOString(),
  totals: {
    total_cards: 3,
    quiz: 2,
    apply: 1,
    review: 0,
  },
  segments: [
    {
      phase: 'quiz',
      focus: '巩固关键事实，刷新最新上下文',
      focus_details: {
        headline: '方向：Rust×检索 · 技能：向量索引调优',
        highlights: [
          '近 48 小时错题 2/5，需要再巩固一次',
          '稳定度较低的程序类卡片优先',
        ],
        direction_breakdown: [
          {
            direction_id: 'dir-rag',
            name: 'AI × Retrieval',
            stage: 'attack',
            count: 2,
            share: 0.67,
            signals: ['近 7 天缺席 2 次', '关联任务：本周技术分享'],
          },
        ],
        skill_breakdown: [
          {
            skill_point_id: 'skill-hnsw',
            name: '向量索引调优',
            level: 'working',
            count: 2,
            share: 0.67,
            signals: ['稳定度 0.32', 'KV 贡献 +1.8'],
          },
          {
            skill_point_id: 'skill-embedding',
            name: 'Embedding 质量诊断',
            level: 'emerging',
            count: 1,
            share: 0.33,
            signals: ['关联 Evidence 需要复核'],
          },
        ],
      },
      items: [
        {
          item_id: 'item-1',
          sequence: 1,
          card: {
            id: 'card-1',
            direction_id: 'dir-rag',
            skill_point_id: 'skill-hnsw',
            title: 'HNSW Graph 的搜索复杂度？',
            body: '在 HNSW 中，搜索复杂度约为 O(log N)，但受图层质量与 ef 值影响。',
            card_type: 'fact',
            stability: 0.32,
            relevance: 0.68,
            novelty: 0.22,
            priority: 0.74,
            next_due: new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000).toISOString(),
            created_at: new Date(now.getTime() - 20 * 24 * 60 * 60 * 1000).toISOString(),
            updated_at: new Date(now.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString(),
          },
        },
        {
          item_id: 'item-2',
          sequence: 2,
          card: {
            id: 'card-2',
            direction_id: 'dir-rag',
            skill_point_id: 'skill-hnsw',
            title: 'efConstruction 如何影响回忆率？',
            body: 'efConstruction 越高，图连通性更好，召回率提升但构建时间增加。',
            card_type: 'concept',
            stability: 0.28,
            relevance: 0.73,
            novelty: 0.18,
            priority: 0.79,
            next_due: new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000).toISOString(),
            created_at: new Date(now.getTime() - 12 * 24 * 60 * 60 * 1000).toISOString(),
            updated_at: new Date(now.getTime() - 1 * 24 * 60 * 60 * 1000).toISOString(),
          },
        },
      ],
    },
    {
      phase: 'apply',
      focus: '准备设计评审，聚焦应用演练',
      focus_details: {
        headline: '今日应用：准备 Retrieval 设计评审',
        highlights: ['根据 PRD 练习描述设计决策', '优先引用最近更新的证据'],
        direction_breakdown: [
          {
            direction_id: 'dir-rag',
            name: 'AI × Retrieval',
            stage: 'attack',
            count: 1,
            share: 1,
            signals: ['关联任务：评审 10/10', '应用权重 +0.3'],
          },
        ],
        skill_breakdown: [
          {
            skill_point_id: 'skill-embedding',
            name: 'Embedding 质量诊断',
            level: 'emerging',
            count: 1,
            share: 1,
            signals: ['上次演练反馈待改进'],
          },
        ],
      },
      items: [
        {
          item_id: 'item-3',
          sequence: 3,
          card: {
            id: 'card-3',
            direction_id: 'dir-rag',
            skill_point_id: 'skill-embedding',
            title: '写出 embedding 质量复盘模板',
            body: '分三段描述：数据分布、模型参数、线下指标 -> 得出优化清单。',
            card_type: 'procedure',
            stability: 0.21,
            relevance: 0.81,
            novelty: 0.34,
            priority: 0.84,
            next_due: new Date(now.getTime() + 5 * 24 * 60 * 60 * 1000).toISOString(),
            created_at: new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString(),
            updated_at: new Date(now.getTime() - 12 * 60 * 60 * 1000).toISOString(),
          },
        },
      ],
    },
  ],
};

export const mockWorkoutSummary: WorkoutCompletionSummary = {
  workout_id: mockTodayWorkout.workout_id,
  completed_at: new Date(now.getTime() + 20 * 60 * 1000).toISOString(),
  metrics: {
    total_items: 3,
    pass_count: 2,
    fail_count: 1,
    pass_rate: 2 / 3,
    kv_delta: 1.8,
    udr: 0.27,
    recommended_focus: '下一步复盘 embedding 质量诊断',
    direction_breakdown: [
      {
        direction_id: 'dir-rag',
        name: 'AI × Retrieval',
        stage: 'attack',
        total: 3,
        pass_count: 2,
        fail_count: 1,
        pass_rate: 2 / 3,
        kv_delta: 1.4,
        udr: 0.31,
        avg_priority: 0.78,
        share: 1,
      },
    ],
    skill_breakdown: [
      {
        skill_point_id: 'skill-hnsw',
        name: '向量索引调优',
        level: 'working',
        total: 2,
        pass_count: 1,
        fail_count: 1,
        pass_rate: 0.5,
        kv_delta: 0.8,
        udr: 0.18,
        avg_priority: 0.7,
        share: 2 / 3,
      },
      {
        skill_point_id: 'skill-embedding',
        name: 'Embedding 质量诊断',
        level: 'emerging',
        total: 1,
        pass_count: 1,
        fail_count: 0,
        pass_rate: 1,
        kv_delta: 1,
        udr: 0.42,
        avg_priority: 0.84,
        share: 1 / 3,
      },
    ],
  },
  insights: [
    'KV +1.8，保持每日演练可以巩固 Procedural 卡片。',
    'embedding 方向仍有不确定性，建议加入真实案例复盘。',
  ],
  updates: [
    {
      card_id: 'card-1',
      result: 'pass',
      stability: 0.44,
      priority: 0.62,
      next_due: new Date(now.getTime() + 6 * 24 * 60 * 60 * 1000).toISOString(),
    },
    {
      card_id: 'card-2',
      result: 'fail',
      stability: 0.19,
      priority: 0.91,
      next_due: new Date(now.getTime() + 1 * 24 * 60 * 60 * 1000).toISOString(),
    },
    {
      card_id: 'card-3',
      result: 'pass',
      stability: 0.36,
      priority: 0.75,
      next_due: new Date(now.getTime() + 4 * 24 * 60 * 60 * 1000).toISOString(),
    },
  ],
};
